# Problem 2: Even Fibonacci Numbers

## Promblem Description

Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:

1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...

By considering the terms in the Fibonacci sequence whose values do not exceed `n`, find the sum of the even-valued terms.

## Solution Strategy

### 1. Fibonacci definition

Let

$$
f(1)=1,\quad f(2)=1,\quad f(3)=2,
$$

and for all `n >= 4`

$$
f(n)=f(n-1)+f(n-2).
$$

### 2. Parity cycle observation

|    _n_ | 1 | 2 | 3     | 4 | 5 | 6     | 7  | 8  | 9      | 10 |
| -----: | - | - | ----- | - | - | ----- | -- | -- | ------ | -- |
| _f(n)_ | 1 | 1 | **2** | 3 | 5 | **8** | 13 | 21 | **34** | 55 |
| parity | O | O | **E** | O | O | **E** | O  | O  | **E**  | O  |

Modulo 2 the sequence repeats every **three** steps, so every third term is even.\
Define the even‑valued subsequence

$$
E_k := f(3k)\qquad(k \ge 1),
$$

yielding `2, 8, 34, 144, …`.

### 3. Deriving the recurrence

Expand the base recurrence three times:

$$
\begin{aligned}
f(3k+3) & = f(3k+2) + f(3k+1) \\
        & = \bigl[f(3k+1) + f(3k)\bigr] + \bigl[f(3k) + f(3k-1)\bigr] \\
        & = 2f(3k) + f(3k+1) + f(3k-1).
\end{aligned}
$$

Since `f(3k+1) = f(3k) + f(3k-1)`,

$$
f(3k+3) = 4f(3k) + f(3k-3).
$$

Thus the every‑third‑term recurrence is

$$
\boxed{\;f(3k+3) = 4f(3k) + f(3k-3)\;} \quad (k \ge 1).
$$

### 4. Initial anchors

Taking the formal value `f(0)=0` gives

$$
E_0 = 0,\quad E_1 = 2.
$$

With

$$
E_{k+1} = 4E_k + E_{k-1},
$$

the entire even subsequence is produced in `O(log N)` iterations.

## Code

```python
def fiboEvenSum(n: int) -> int:
    """
    Return the sum of all even Fibonacci numbers less than or equal to n,
    using the recurrence relation E_k = 4*E_{k-1} + E_{k-2} for even terms.
    """
    prev, curr = 0, 2   # Initialize E_0 = 0, E_1 = 2
    total = 0

    while curr <= n:
        total += curr
        prev, curr = curr, 4 * curr + prev  # Compute next even Fibonacci number

    return total


# Test cases from the image
if __name__ == "__main__":
    test_cases = [
        (10, 10),
        (34, 44),
        (60, 44),
        (1000, 798),
        (100000, 60696),
        (4000000, 4613732),
    ]

    for i, (inp, expected) in enumerate(test_cases, 1):
        result = fiboEvenSum(inp)
        print(f"Test {i}: fiboEvenSum({inp}) = {result}  --> {'OK' if result == expected else 'FAIL'}")

```
